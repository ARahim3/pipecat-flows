<!--
Copyright (c) 2024, Daily

SPDX-License-Identifier: BSD 2-Clause License
-->

<!DOCTYPE html>
<html data-theme="dark">

<head>
  <title>Pipecat Flow Editor</title>

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/png" href="/favicon.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/node_modules/litegraph.js/css/litegraph.css">
  <link rel="stylesheet" href="/css/tailwind.css">
</head>

<body class="min-h-screen bg-base-300">
  <!-- Main Layout Container -->
  <div class="flex h-screen">
    <!-- Side Panel -->
    <div id="side-panel" class="w-[350px] bg-base-200 flex flex-col">
      <!-- Toolbar Section -->
      <div class="p-4 border-b border-base-300">
        <div class="flex justify-center gap-6">
          <button id="new-flow" class="btn btn-sm btn-primary">New Flow</button>
          <button id="import-flow" class="btn btn-sm btn-primary">Import</button>
          <button id="export-flow" class="btn btn-sm btn-primary">Export</button>
        </div>
      </div>

      <!-- Editor Content Section -->
      <div class="flex-1 overflow-y-auto">
        <div class="p-5">
          <!-- Editor Title -->
          <h2 id="editor-title" class="text-xl font-bold mb-2 border-base-300">
            Node Editor
          </h2>

          <!-- No Selection Message -->
          <div class="no-selection-message text-center text-base-content/60 p-5">
            Select a node to edit its contents
          </div>

          <!-- Editor Content (hidden by default) -->
          <div class="editor-content hidden space-y-4">
            <!-- Message Editor Section -->
            <div class="message-editor">
              <!-- Message Input -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Message</span>
                </label>
                <textarea id="message-editor"
                  class="textarea textarea-bordered font-mono text-xs h-[calc(50vh-200px)]"></textarea>
              </div>

              <!-- Pre-actions Input -->
              <div class="form-control mt-4">
                <label class="label">
                  <span class="label-text">Pre-actions</span>
                </label>
                <textarea id="pre-actions-editor"
                  class="textarea textarea-bordered font-mono text-xs h-[calc(25vh-100px)]"></textarea>
              </div>

              <!-- Post-actions Input -->
              <div class="form-control mt-4">
                <label class="label">
                  <span class="label-text">Post-actions</span>
                </label>
                <textarea id="post-actions-editor"
                  class="textarea textarea-bordered font-mono text-xs h-[calc(25vh-100px)]"></textarea>
              </div>
            </div>

            <!-- Function Editor Section (hidden by default) -->
            <div class="function-editor hidden">
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Function</span>
                </label>
                <textarea id="function-editor"
                  class="textarea textarea-bordered font-mono text-xs h-[calc(100vh-300px)]"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Graph Container -->
    <div id="graph-container" class="flex-1 relative bg-base-300">
      <canvas id="graph-canvas"></canvas>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/node_modules/litegraph.js/build/litegraph.js"></script>
  <script type="module" src="/js/main.js"></script>

  <!-- Confirmation modal before creating new flow -->
  <dialog id="new-flow-modal" class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Create New Flow?</h3>
      <p class="py-4">This will clear your current work. Are you sure you want to continue?</p>
      <div class="modal-action">
        <button id="cancel-new-flow" class="btn btn-sm btn-secondary">Cancel</button>
        <button id="confirm-new-flow" class="btn btn-sm btn-primary">Create New</button>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>
</body>

</html>